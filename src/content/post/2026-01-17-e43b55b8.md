---
title: "Meguro.vim #33に参加した"
date: 2026-01-17
description: ""
type: tech
---

恒例行事。

[Meguro.vim #33](https://megurovim.connpass.com/event/375394/)

## やったこと

### Pinosuの整理

Kind 39701のイベントを見るためのアプリをAndroidの勉強がてら作らせている。

リレーの取得を[NIP 65](https://github.com/nostr-protocol/nips/blob/f34e98c73f47fed6778e2fc62b256f925bead065/65.md)をベースに取得するようにした。

投稿ができるようになった。べんり。

### renovateの設定変更

自分で使うnixのpackageを独自に[nur-packages](https://github.com/Omochice/nur-packages)にまとめている。

2週間ほどrenovateでPRが作られなくなっていたので調べた。

[1b97ebb6ad2a100eafba1bf3e50ea07f69d1d065](https://github.com/Omochice/nur-packages/commit/1b97ebb6ad2a100eafba1bf3e50ea07f69d1d065)で`flake.lock`を更新した結果、renovateが`41.169.3`から`42.57.1`に更新された。

その結果依存の更新のPRが作られなくなっていた。

```text
2026-01-17T06:16:33.4108084Z DEBUG: POST https://api.github.com/repos/Omochice/nur-packages/statuses/:id = (code=ERR_NON_2XX_3XX_RESPONSE, statusCode=403 retryCount=0, duration=93) (repository=Omochice/nur-packages, branch=self-hosted-renovate/cc-sdd-2.x)
2026-01-17T06:16:33.4120835Z DEBUG: GitHub failure: Resource not accessible by integration (repository=Omochice/nur-packages, branch=self-hosted-renovate/cc-sdd-2.x)
```

v42のリリースノートを見ても該当のbreaking changeはないみたいだった。

ただ、`https://api.github.com/repos/Omochice/nur-packages/statuses/:id`にpostして落ちてるみたいだったのでGitHubのAPIドキュメントを見ると以下の記載があった。

> The fine-grained token must have the following permission set:
>
> - "Commit statuses" repository permissions (write)

<https://docs.github.com/en/rest/commits/statuses?apiVersion=2022-11-28#create-a-commit-status>

具体的にこの変更がどこ起因なのか解っていないが、もともとのapp-tokenだとこの権限が付与されていなかったので、追加してことなきを得た。

```diff
diff --git a/.github/workflows/renovate.yml b/.github/workflows/renovate.yml
index 7482e9d..133c671 100644
--- a/.github/workflows/renovate.yml
+++ b/.github/workflows/renovate.yml
@@ -25,9 +25,11 @@ jobs:
           owner: ${{ github.repository_owner }}
           repositories: |
             nur-packages
+          permission-checks: write
           permission-contents: write
           permission-issues: write
           permission-pull-requests: write
+          permission-statuses: write
       - name: Checkout repository
         uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
         with:
```

[ci: add missing permissions by Omochice · Pull Request #395 · Omochice/nur-packages](https://github.com/Omochice/nur-packages/pull/395)

スタックトレースは以下のとおり。

(見やすいように折り返している)

```text
2026-01-17T06:16:33.4446304Z DEBUG: Caught error setting branch status - aborting (repository=Omochice/nur-packages, branch=self-hosted-renovate/cc-sdd-2.x)
2026-01-17T06:16:33.4447417Z        "err": {
2026-01-17T06:16:33.4447754Z          "message": "integration-unauthorized",
2026-01-17T06:16:33.4458317Z          "stack": "Error: integration-unauthorized\n
                                                    at handleGotError (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/util/http/github.ts:154:12)\n
                                                    at GithubHttp.handleError (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/util/http/github.ts:369:11)\n
                                                    at GithubHttp.request (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/util/http/http.ts:258:12)\n
                                                    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n
                                                    at GithubHttp.requestJsonUnsafe (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/util/http/github.ts:383:20)\n
                                                    at GithubHttp.requestJson (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/util/http/http.ts:359:17)\n
                                                    at Proxy.setBranchStatus (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/modules/platform/github/index.ts:1273:5)\n
                                                    at setStatusCheck (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/update/branch/status-checks.ts:55:5)\n
                                                    at setStability (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/update/branch/status-checks.ts:93:3)\n
                                                    at processBranch (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/update/branch/index.ts:744:5)\n
                                                    at res.attributes (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/process/write.ts:177:21)\n
                                                    at writeUpdates (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/process/write.ts:150:17)\n
                                                    at update (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/process/extract-update.ts:253:11)\n
                                                    at Object.renovateRepository (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/repository/index.ts:142:19)\n
                                                    at attributes (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/global/index.ts:198:11)\n
                                                    at start (/nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/workers/global/index.ts:183:7)\n
                                                    at /nix/store/4bb1ckc940bxq3mpspr9qyb7z4r5qllw-renovate-42.57.1/lib/node_modules/renovate/lib/renovate.ts:19:22"
```

### claudeのskills整備

`/pr-comments`していろいろ直させるのが多いのでskillsを使いたい。

[`anthropics/skills`](https://github.com/anthropics/skills)をhome-managerで置くようにした。

~あとはらきすたを8話までみました。~
